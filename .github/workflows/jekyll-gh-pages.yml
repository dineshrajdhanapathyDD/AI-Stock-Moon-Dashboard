name: Deploy Stock Moon Dashboard

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
        
    - name: Cache dependencies
      uses: actions/cache@v3
      with:
        path: ~/.cache/pip
        key: ${{ runner.os }}-pip-${{ hashFiles('**/requirements.txt') }}
        restore-keys: |
          ${{ runner.os }}-pip-
          
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        
    - name: Run tests
      run: |
        echo "Running comprehensive test suite..."
        python test_complete_system.py
        
    - name: Build validation
      run: |
        echo "Validating build..."
        python build.py
        
    - name: Generate deployment artifacts
      run: |
        echo "Creating deployment package..."
        python -c "
import json
from datetime import datetime
build_info = {
    'build_time': datetime.now().isoformat(),
    'commit_sha': '${{ github.sha }}',
    'branch': '${{ github.ref_name }}',
    'status': 'success'
}
with open('build_info.json', 'w') as f:
    json.dump(build_info, f, indent=2)
print('âœ… Build artifacts created')
        "

  deploy-notification:
    needs: test
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main' && github.event_name == 'push'
    
    steps:
    - name: Deployment Ready
      run: |
        echo "ðŸš€ Tests passed! Ready for deployment."
        echo "ðŸ“Š Dashboard URL will be available after platform deployment."
        echo "ðŸ”— Connect this repository to your preferred platform:"
        echo "   â€¢ Render: https://render.com"
        echo "   â€¢ Railway: https://railway.app" 
        echo "   â€¢ Heroku: https://heroku.com"
        echo "   â€¢ Vercel: https://vercel.com"
